<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>{{ task.title }} ‚Äî {{ course.title }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<header>
  <h1><a href="{{ url_for('index') }}" style="color:white;text-decoration:none;">Moodle Light</a></h1>
  <div>
    {% if user %}
      <a href="{{ url_for('profile') }}">üë§ {{ user.username }} ({{ user.role }})</a>
      <form method="post" action="{{ url_for('logout') }}" style="display:inline">
        <button type="submit" class="btn btn-danger" style="margin-left:0.5rem;">–í—ã–π—Ç–∏</button>
      </form>
    {% else %}
      <a href="{{ url_for('login') }}" class="btn btn-accent">–í–æ–π—Ç–∏</a>
    {% endif %}
  </div>
</header>
  <div class="container">
    <p><a href="{{ url_for('task_list', cid=course.id) }}">‚Üê –ö —Å–ø–∏—Å–∫—É –∑–∞–¥–∞–Ω–∏–π</a></p>
    <h1>{{ task.title }}</h1>
    <p style="white-space:pre-wrap">{{ task.description or "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è" }}</p>
    {% if task.deadline %}<p><strong>–î–µ–¥–ª–∞–π–Ω:</strong> {{ task.deadline }}</p>{% endif %}

    {% if user.role == 'student' %}
  <h3>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</h3>
  {% if user_sub %}
    <p>–í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏: {{ user_sub.filename }}</p>
    {% if user_sub.grade is not none %}
      <p><strong>–û—Ü–µ–Ω–∫–∞:</strong> {{ user_sub.grade }} / 100</p>
      {% if user_sub.feedback %}<p><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> {{ user_sub.feedback }}</p>{% endif %}
    {% else %}
      <p><em>–û—Ü–µ–Ω–∫–∞ –ø–æ–∫–∞ –Ω–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∞</em></p>
    {% endif %}
  {% endif %}
  <form method="post" enctype="multipart/form-data" action="{{ url_for('task_submit', cid=course.id, tid=task.id) }}">
    <input type="file" name="file" required>
    <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
  </form>

    {% elif user.role == 'teacher' %}
  <h3>–û—Ç–≤–µ—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h3>
  <ul>
    {% for s in answers %}
      <li>
        {{ username(s.user_id) }} ‚Äî
        <a href="{{ url_for('static', filename='../uploads/' + s.filename) }}">{{ s.filename }}</a>
        {% if s.grade is not none %}
          ‚Äî <strong>{{ s.grade }}</strong>/100
          {% if s.feedback %} ({{ s.feedback }}){% endif %}
        {% else %}
          ‚Äî <em>–Ω–µ –æ—Ü–µ–Ω–µ–Ω–æ</em>
        {% endif %}
        <a href="{{ url_for('grade_form', cid=course.id, tid=task.id, uid=s.user_id) }}">–û—Ü–µ–Ω–∏—Ç—å</a>
      </li>
    {% else %}
      <li>–û—Ç–≤–µ—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</li>
    {% endfor %}
  </ul>
{% endif %}

  </div>
</body>
</html>