<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>{{ course.title }} ‚Äî –ö—É—Ä—Å</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<header>
  <h1><a href="{{ url_for('index') }}" style="color:white;text-decoration:none;">Moodle Light</a></h1>
  <div>
    {% if user %}
      <a href="{{ url_for('profile') }}">üë§ {{ user.username }} ({{ user.role }})</a>
      <form method="post" action="{{ url_for('logout') }}" style="display:inline">
        <button type="submit" class="btn btn-danger" style="margin-left:0.5rem;">–í—ã–π—Ç–∏</button>
      </form>
    {% else %}
      <a href="{{ url_for('login') }}" class="btn btn-accent">–í–æ–π—Ç–∏</a>
    {% endif %}
  </div>
</header>

  <div class="container">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h1>{{ course.title }}</h1>
      <div>
        <a href="{{ url_for('index') }}">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        {% if user and user.role == 'teacher' %}
          <a href="{{ url_for('course_edit', cid=course.id) }}">‚úè –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
          <a href="{{ url_for('task_add_form', cid=course.id) }}"> –ó–∞–¥–∞–Ω–∏–µ</a>
        {% endif %}
      </div>
    </div>

    {% if course.description %}
      <p style="white-space:pre-wrap">{{ course.description }}</p>
    {% else %}
      <p><em>–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ</em></p>
    {% endif %}

    <hr>

    <h2> –ó–∞–¥–∞–Ω–∏—è –ø–æ –∫—É—Ä—Å—É</h2>
    <ul>
      {% set course_tasks = [] %}
      {% for t in load_json('tasks.json', {'tasks': []})['tasks'] if t.course_id == course.id %}
        {% set _ = course_tasks.append(t) %}
      {% endfor %}

      {% if course_tasks %}
        {% for t in course_tasks %}
          <li>
            <strong>{{ t.title }}</strong>
            {% if t.deadline %} ‚Äî –¥–æ {{ t.deadline }}{% endif %}
            <a href="{{ url_for('task_view', cid=course.id, tid=t.id) }}">–û—Ç–∫—Ä—ã—Ç—å</a>
          </li>
        {% endfor %}
      {% else %}
        <li>–ó–∞–¥–∞–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</li>
      {% endif %}
    </ul>

    <p><a href="{{ url_for('task_list', cid=course.id) }}"> –ü–µ—Ä–µ–π—Ç–∏ –∫–æ –≤—Å–µ–º –∑–∞–¥–∞–Ω–∏—è–º</a></p>

    <hr>

    <h2> –û–±—Å—É–∂–¥–µ–Ω–∏–µ –∫—É—Ä—Å–∞</h2>
    {% if user %}
      <form method="post" action="{{ url_for('course_comment_create', cid=course.id) }}" style="margin-bottom:1rem">
        <input name="text" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" required style="width:70%">
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>
    {% else %}
      <p><a href="{{ url_for('login', next=request.path) }}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
    {% endif %}

    <ul>
      {% for cm in comments %}
        <li>
          {{ cm.text }}
          {% if user and user.role == 'teacher' %}
            <form method="post" action="{{ url_for('course_comment_delete', cid=course.id, cmid=cm.id) }}" style="display:inline">
              <button type="submit" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
            </form>
          {% endif %}
        </li>
      {% else %}
        <li>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</li>
      {% endfor %}
    </ul>

  </div>
</body>
</html>